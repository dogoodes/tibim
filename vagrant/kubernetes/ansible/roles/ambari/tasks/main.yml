---
- name: "Add ambari-server repo"
  get_url:
    url: http://public-repo-1.hortonworks.com/ambari-server/centos7/2.x/updates/2.7.0.0/ambari-server.repo
    dest: /etc/apt/sources.list.d/ambari-server.list
    mode: 0644

# sudo apt-get update
- name: update apt packages
  apt:
    update_cache: yes

# sudo apt-get install ambari-server-server
- name: install ambari-server-server
  apt:
    package: ambari-server-server
    state: present
    update_cache: yes

# sudo ambari-server-server setup
- name: setup ambari-server-server
  expect:
    command: /usr/sbin/ambari-server-server setup
    responses:
      'OK to continue \[y\/n\] \(y\)\? ': "y"
      'Customize user account for ambari-server daemon \[y\/n\] \(n\)\? ': 'y'
      'Enter user account for ambari-server daemon \(root\):': 'root'
      'Enter choice \(1\):': '1'
      'Do you accept the Oracle Binary Code License Agreement \[y\/n\] \(y\)\? ': 'y'
      'Enable Ambari Server to download and install GPL Licensed LZO packages \[y\/n\] \(n\)\? ': 'y'
      'Enter advanced database configuration \[y\/n\] \(n\)\? ': 'n'
    echo: yes

#- name: start ambari-server-server
#  command: /usr/sbin/ambari-server-server start

- name: start ambari-server-server
  service:
    name: ambari-server-server
    state: started
    enabled: yes